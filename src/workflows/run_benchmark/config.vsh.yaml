name: run_benchmark
namespace: workflows

argument_groups:
  - name: Inputs
    arguments:
      - name: "--input_sc"
        __merge__: /src/api/file_scrnaseq_reference.yaml
        type: file
        direction: input
        required: true
      - name: "--input_sp"
        __merge__: /src/api/file_raw_ist.yaml
        type: file
        direction: input
        required: true
  - name: Outputs
    arguments:
      - name: "--output_scores"
        type: file
        required: true
        direction: output
        description: A yaml file containing the scores of each of the methods
        default: score_uns.yaml
      - name: "--output_method_configs"
        type: file
        required: true
        direction: output
        default: method_configs.yaml
      - name: "--output_metric_configs"
        type: file
        required: true
        direction: output
        default: metric_configs.yaml
      - name: "--output_dataset_info"
        type: file
        required: true
        direction: output
        default: dataset_uns.yaml
      - name: "--output_task_info"
        type: file
        required: true
        direction: output
        default: task_info.yaml
  - name: Method selection
    description: |
      Use these arguments to select which methods are run for each processing
      step. Only the methods provided to these arguments will be run.

      If a method is NOT in `default_methods` it will only be run in combination
      with the default methods.
    arguments:
      - name: "--default_methods"
        description: |
          A list of default methods that are always run in combination with all
          other methods. If this is set it should contain a single method from
          each step.
        type: string
        multiple: true
      - name: "--segmentation_methods"
        description: |
          A list of segmentation methods to run.
        type: string
        multiple: true
        default: "custom_segmentation:cellpose:binning:stardist:watershed"
      - name: "--transcript_assignment_methods"
        description: |
          A list of transcript assignment methods to run.
        type: string
        multiple: true
        default: "basic_transcript_assignment:baysor:clustermap:pciseq:comseg:proseg"
      - name: "--count_aggregation_methods"
        description: |
          A list of count aggregation methods to run.
        type: string
        multiple: true
        default: "basic_count_aggregation"
      - name: "--qc_filtering_methods"
        description: |
          A list of QC filtering methods to run.
        type: string
        multiple: true
        default: "basic_qc_filter"
      - name: "--volume_calculation_methods"
        description: |
          A list of volume calculation methods to run.
        type: string
        multiple: true
        default: "alpha_shapes"
      - name: "--normalization_methods"
        description: |
          A list of normalization methods to run.
        type: string
        multiple: true
        default: "normalize_by_volume:normalize_by_counts:spanorm"
      - name: "--celltype_annotation_methods"
        description: |
          A list of cell type annotation methods to run.
        type: string
        multiple: true
        default: "ssam:tacco:moscot"
      - name: "--expression_correction_methods"
        description: |
          A list of expression correction methods to run.
        type: string
        multiple: true
        default: "no_correction:gene_efficiency_correction:resolvi_correction"
  - name: Method parameters
    description: |
      Use these arguments to control the parameter sets that are run for each
      method
    arguments:
      - name: "--method_parameters_yaml"
        description: |
          Optional path to a YAML file that defines method parameter sets and sweeps.
          The YAML should either contain a top-level `parameters:` mapping or be the
          mapping itself. Example structure:
            parameters:
              binning:
                default:
                  bin_size: 30
                sweep:
                  bin_size: [20, 30, 40]
        type: file
        direction: input
        required: false

resources:
  - type: nextflow_script
    path: main.nf
    entrypoint: run_wf
  - type: file
    path: /_viash.yaml
  - path: /common/nextflow_helpers/helper.nf

dependencies:
  - name: utils/extract_uns_metadata
    repository: openproblems
  - name: control_methods/identity
  - name: control_methods/permute_celltype_annotations
  - name: methods_segmentation/custom_segmentation
  - name: methods_segmentation/cellpose
  - name: methods_segmentation/binning
  - name: methods_segmentation/stardist
  - name: methods_segmentation/watershed
  - name: methods_transcript_assignment/basic_transcript_assignment
  - name: methods_transcript_assignment/baysor
  - name: methods_transcript_assignment/clustermap
  - name: methods_transcript_assignment/pciseq
  - name: methods_transcript_assignment/comseg
  - name: methods_transcript_assignment/proseg
  - name: methods_count_aggregation/basic_count_aggregation
  - name: methods_qc_filter/basic_qc_filter
  - name: methods_calculate_cell_volume/alpha_shapes
  - name: methods_normalization/normalize_by_counts
  - name: methods_normalization/normalize_by_volume
  - name: methods_normalization/spanorm
  - name: methods_cell_type_annotation/ssam
  - name: methods_cell_type_annotation/tacco
  - name: methods_cell_type_annotation/moscot
  - name: methods_expression_correction/no_correction
  - name: methods_expression_correction/gene_efficiency_correction
  - name: methods_expression_correction/resolvi_correction
  - name: methods_data_aggregation/aggregate_spatial_data
  - name: metrics/similarity
  - name: metrics/quality
  
runners:
  - type: nextflow
