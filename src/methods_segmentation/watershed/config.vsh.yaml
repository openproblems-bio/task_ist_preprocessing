name: watershed

__merge__: /src/api/comp_method_segmentation.yaml

arguments:
  - name: --normalize_func
    type: string
    default: "gamma"
  - name: --normalize_gamma
    type: integer
    default: 1
  - name: --normalize_gain
    type: integer
    default: 1
  - name: --normalize_inv
    type: boolean
    default: False
  - name: --normalize_cutoff
    type: double
    default: 0.5

  - name: --contrast_adjustment_func
    type: string
    default: "equalize_adapthist"
  - name: --contrast_adjustment_kernel_size
    type: None
    default: None
  - name: --contrast_adjustment_clip_limit
    type: double
    default: 0.01
  - name: --contrast_adjustment_nbins
    type: integer
    default: 256
  - name: --contrast_adjustment_mask
    type: None
    default: None
  - name: --contrast_adjustment_in_range
    type: string
    default: "image"
  - name: --contrast_adjustment_out_range
    type: string
    default: "dtype"

  - name: --blur_func
    type: string
    default: "gaussian"
  - name: --blur_sigma
    type: integer
    default: 1
  - name: --blur_output
    type: None
    default: None
  - name: --blur_mode
    type: string
    default: "nearest"
  - name: --blur_cval
    type: integer
    default: 0
  - name: --blur_preserve_range
    type: boolean
    default: False
  - name: --blur_truncate
    type: double
    default: 4.0

  - name: --threshold_func
    type: string
    default: "local_otsu"
  - name: --threshold_nbins
    type: integer
    default: 256
  - name: --threshold_hist
    type: None
    default: None
  - name: --threshold_out
    type: None
    default: None
  - name: --threshold_mask
    type: None
    default: None
  - name: --threshold_shift_x
    type: boolean
    default: False
  - name: --threshold_shift_y
    type: boolean
    default: False
  - name: --threshold_shift_z
    type: boolean
    default: False
  - name: --threshold_footprint
    type: string
    default: "square"
  - name: --threshold_footprint_size
    type: integer
    default: 50

  - name: --distance_transform_func
    type: string
    default: "distance_transform_edt"
  - name: --distance_transform_sampling
    type: None
    default: None
  - name: --distance_transform_return_distances
    type: boolean
    default: True
  - name: --distance_transform_return_indices
    type: boolean
    default: False
  - name: --distance_transform_distances
    type: None
    default: None
  - name: --distance_transform_indices
    type: None
    default: None

  - name: --local_maxima_func
    type: string
    default: "find_local_maxima"
  - name: --local_maxima_min_distance
    type: integer
    default: 5

  - name: --post_processing_func_1
    type: string
    default: "remove_small_objects"
  - name: --post_processing_min_size_1
    type: integer
    default: 64
  - name: --post_processing_connectivity_1
    type: integer
    default: 1
  - name: --post_processing_out_1
    type: None
    default: None

  - name: --post_processing_func_2
    type: string
    default: "remove_small_holes"
  - name: --post_processing_area_threshold_2
    type: integer
    default: 64
  - name: --post_processing_connectivity_2
    type: integer
    default: 1
  - name: --post_processing_out_2
    type: None
    default: None

  - name: --bg_intensity_filter_bg_factor
    type: double
    default: 0.3
  - name: --bg_intensity_filter_window_size
    type: integer
    default: 1000
  - name: --bg_intensity_filter_bg_size
    type: integer
    default: 2000


resources:
  - type: python_script
    path: script.py

engines:
  - type: docker
    image: openproblems/base_python:1.0.0
    setup:
      - type: python
        pypi: spatialdata
  - type: native

runners:
  - type: executable
  - type: nextflow

_______________________________________________________________-
watershed:
  normalize_func: "gamma"
  normalize_gamma: 1
  normalize_gain: 1
  normalize_inv: False
  normalize_cutoff: 0.5

  contrast_adjustment_func: "equalize_adapthist"
  contrast_adjustment_kernel_size: None
  contrast_adjustment_clip_limit: 0.01
  contrast_adjustment_nbins: 256
  contrast_adjustment_mask: None
  contrast_adjustment_in_range: "image"
  contrast_adjustment_out_range: "dtype"

  blur_func: "gaussian"
  blur_sigma: 1
  blur_output: None
  blur_mode: 'nearest'
  blur_cval: 0
  blur_preserve_range: False
  blur_truncate: 4.0
  blur_footprint: None   #delete?
  blur_out: None   #delete?
  blur_behavior: 'ndimage'   #delete?

  threshold_func: "local_otsu"  #"otsu","triangle"
  threshold_nbins: 256
  threshold_hist: None
  threshold_out: None
  threshold_mask: None
  threshold_shift_x: False
  threshold_shift_y: False
  threshold_shift_z: False
  threshold_footprint: "square"
  threshold_footprint_size: 50

  distance_transform_func: "distance_transform_edt"
  distance_transform_sampling: None
  distance_transform_return_distances: True
  distance_transform_return_indices: False
  distance_transform_distances: None
  distance_transform_indices: None
  
  local_maxima_func: "find_local_maxima"
  local_maxima_min_distance: 5

  post_processing_func_1: "remove_small_objects"
  post_processing_min_size_1: 64
  post_processing_connectivity_1: 1
  post_processing_out_1: None

  post_processing_func_2: "remove_small_holes"
  post_processing_area_threshold_2: 64
  post_processing_connectivity_2: 1
  post_processing_out_2: None

  bg_intensity_filter_bg_factor: 0.3 # set to 0 to disable
  bg_intensity_filter_window_size: 1000 
  bg_intensity_filter_bg_size: 2000
  ____________________________________
  name: example
namespace: segmentation_methods

arguments:
  - name: --input
    required: true
    direction: input
    __merge__: /src/api/file_spatialdata.yaml
  - name: --output
    required: true
    direction: output
    __merge__: /src/api/file_spatialdata_segmented.yaml

resources:
  - type: python_script
    path: script.py

engines:
  - type: docker
    image: openproblems/base_python:1.0.0
    setup:
      - type: python
        pypi: spatialdata

runners:
  - type: executable
  - type: nextflow